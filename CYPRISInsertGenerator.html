<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Child SQL Generator</title>
  <script type="module">
    import { faker } from 'https://cdn.skypack.dev/@faker-js/faker';
    window.faker = faker;
  </script>
  <script src="https://cdn.jsdelivr.net/npm/chrono-node@2.3.1/dist/chrono.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 2rem; background: #f0f0f0; }
    input, button { padding: 0.5rem; margin: 0.5rem 0; width: 100%; }
    pre { background: #fff; padding: 1rem; white-space: pre-wrap; border: 1px solid #ccc; }
  </style>
</head>
<body>
  <h1>Child SQL Generator</h1>
  <input type="text" id="dobInput" placeholder="e.g. 312 weeks ago" />
  <button id="generateBtn">Generate SQL</button>
  <pre id="output"></pre>

  <script type="module">
    document.addEventListener("DOMContentLoaded", () => {
      const formatOracleDate = (date) => {
        const months = ["JAN", "FEB", "MAR", "APR", "MAY", "JUN", "JUL", "AUG", "SEP", "OCT", "NOV", "DEC"];
        const day = String(date.getDate()).padStart(2, '0');
        const month = months[date.getMonth()];
        const year = String(date.getFullYear()).slice(-2);
        return `${day}-${month}-${year}`;
      };

      document.getElementById("generateBtn").addEventListener("click", () => {
        const input = document.getElementById("dobInput").value;
        const parsedDate = chrono.parseDate(input);
        const output = document.getElementById("output");

        if (!parsedDate) {
          output.textContent = `⚠️ Invalid date expression: "${input}"`;
          return;
        }

        const dobStr = formatOracleDate(parsedDate);
        const surname = faker.name.lastName();
        const forename = faker.name.firstName();
        const address1 = faker.address.streetAddress();
        const address2 = faker.address.secondaryAddress();
        const address4 = faker.address.city();
        const postcode = faker.address.zipCode().toUpperCase();
        const sex = faker.helpers.arrayElement(['1', '2']);

        const sql = `
INSERT INTO CHILD_GENERAL (
  CLIENT_ID, SECTOR, CURRENT_STATUS, INITIAL_STATUS, CURRENT_STATUS_DATE,
  INITIAL_STATUS_DATE, DATE_OF_BIRTH, SEX, SURNAME, FORENAME,
  ADDRESS1, ADDRESS2, ADDRESS4, POSTCODE, ETHNIC_ORIGIN,
  BTH_REG_DISTRICT, BTH_NUMBER_OF_BIRTHS, BTH_LSD_MARKER, BTH_BIRTH_ORDER,
  BTH_LOCATION, CREATION_DATE, MODIFICATION_DATE, IMMUNISATION_STATUS,
  EXAMINATION_STATUS, FK_CHILD_MERGE_STATUS_ID, CURRENT_MMR_FAILS_NO_REASON,
  CURRENT_OTHER_FAILS_NO_REASON, CURRENT_FAILS_WITH_REASON, CURRENT_STATUS_CHANGED_DATE,
  MOVEMENT_IN_LABELS_REQ, REGISTRARS_REPORT_DATE, FK_BTH_LOCATION_CHILD_LOC_TYPE,
  FK_TRANSFER_FROM_CODE, REGISTRATION_ORIGIN
) VALUES (
  public_demo_seq.nextval, '08', 0, 0, SYSDATE,
  SYSDATE, TO_DATE('${dobStr}', 'DD-MON-RR'), '${sex}', '${surname}', '${forename}',
  '${address1}', '${address2}', '${address4}', '${postcode}', 'A',
  'AA', 1, 1, 1, '7A1A1', SYSDATE, SYSDATE, 3,
  1, 0, 0, 0, 0, SYSDATE,
  'Y', SYSDATE, 6, 'RKUAJ', 'BN'
);`;

        output.textContent = sql.trim();
      });
    });
  </script>
</body>
</html>
